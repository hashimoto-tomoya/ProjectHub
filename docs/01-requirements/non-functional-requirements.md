# 非機能要件

## 性能要件

### レスポンスタイム

| 対象 | 目標値 | 条件 |
|------|--------|------|
| 主要ページ表示（ダッシュボード、一覧） | 3秒以内 | 通常負荷時（同時接続20名以下） |
| ガントチャート表示 | 5秒以内 | 100タスク以下、通常負荷時 |
| API応答（データ取得系） | 1秒以内（P95） | 通常負荷時 |
| API応答（データ更新系） | 2秒以内（P95） | 通常負荷時 |
| レポート・グラフ描画 | 5秒以内 | 1プロジェクト分のデータ |

### スループット・データ量

| 項目 | 想定値 |
|------|--------|
| 同時接続数（通常時） | 〜10名 |
| 同時接続数（最大） | 20名 |
| WBSタスク数 | 1プロジェクトあたり最大500タスク |
| 日報レコード数 | 年間約3,000件（1人・1日・平均0.5件 × 20名 × 240日） |
| 障害・指摘レコード数 | 年間約1,000件 |

---

## 可用性要件

| 項目 | 要件 |
|------|------|
| 目標稼働率 | 99.5%以上（月間許容ダウンタイム: 約3.6時間） |
| サービス提供時間 | 24時間365日（インフラの稼働時間に依存） |
| 計画メンテナンス | 事前通知（1週間前）の上、深夜帯（0:00〜6:00）に実施 |
| RTO（目標復旧時間） | 4時間以内（障害発生から通常運用復旧まで） |
| RPO（目標復旧時点） | 24時間以内（直前バックアップからの最大データ損失許容期間） |

!!! note "インフラ依存事項"
    稼働インフラ（オンプレ/クラウド）が未決定のため、上記はDockerコンテナ環境での目標値とする。
    インフラ確定後に可用性設計（冗長化・フェイルオーバー）の詳細を検討する。

---

## セキュリティ要件

### 認証・認可

| 項目 | 要件 |
|------|------|
| 認証方式 | ID（メールアドレス）+ パスワード認証 |
| セッション有効期限 | 最終操作から30分でセッション切れ |
| 同時セッション | 同一アカウントの複数セッション同時利用を許可する（制限なし） |
| 認可制御 | ロールベースアクセス制御（管理者 / PM / 開発者） |

### パスワードポリシー

| 項目 | ポリシー |
|------|---------|
| 最低文字数 | 8文字以上 |
| 文字種 | 英字（大文字または小文字）＋数字を各1文字以上含むこと |
| 特殊文字 | 推奨するが必須としない |
| 有効期限 | 初回ログイン時のパスワード変更を強制する（その後の定期変更は任意） |
| 履歴制限 | 直前3世代のパスワードの再利用禁止 |

### アクセス制限

| 項目 | 要件 |
|------|------|
| IPアクセス制限 | 社内ネットワーク（指定IPアドレス/CIDRレンジ）からのアクセスのみ許可する |
| 設定方法 | Dockerホスト側のファイアウォールまたはリバースプロキシの設定で制御 |

### データ保護

| 項目 | 要件 |
|------|------|
| 通信暗号化 | HTTPS（TLS 1.2以上）を強制する。HTTPでのアクセスはHTTPSへリダイレクト |
| パスワード保存 | bcrypt等の強力なハッシュアルゴリズムを使用（平文保存禁止） |
| DB接続 | 接続情報は環境変数または秘密管理の仕組みで管理し、ソースコードへのハードコード禁止 |

### 脆弱性対策

| 対象 | 対応方針 |
|------|---------|
| SQLインジェクション | ORMのパラメータバインドを使用し、動的SQL組み立てを禁止 |
| XSS | 出力エスケープの徹底、Content Security Policy（CSP）ヘッダの設定 |
| CSRF | CSRFトークンまたはSameSite Cookie属性による対策 |
| 依存ライブラリ | npm auditによる脆弱性チェックをCI/CDに組み込む |

### 操作ログ

| 項目 | 要件 |
|------|------|
| 記録対象 | ログイン/ログアウト、ユーザー管理操作（追加・編集・無効化）、レビュー指摘・障害の登録・更新・削除 |
| 記録項目 | タイムスタンプ、実行ユーザー、操作内容、対象リソース |
| 保持期間 | 90日以上 |
| アクセス権 | 操作ログの閲覧は管理者ロールのみ |

---

## 運用・保守要件

### バックアップ

| 項目 | 要件 |
|------|------|
| 対象 | PostgreSQLデータベース全体 |
| 頻度 | 不定期（手動） |
| 保持世代数 | 7世代（直近7日分） |
| 保管場所 | Dockerホストのローカルボリューム（別ディスクが望ましい） |
| リストア確認 | リストア手順をドキュメント化し、定期的に確認する |

### ログ管理

| 対象 | 保持期間 |
|------|---------|
| アプリケーションログ | 30日 |
| アクセスログ | 30日 |
| 操作ログ | 90日以上 |
| エラーログ | 90日 |

### 監視

| 項目 | 要件 |
|------|------|
| 死活監視 | Dockerコンテナの稼働確認（ヘルスチェックエンドポイントを設ける） |
| エラー監視 | アプリケーションのエラーログ出力による確認 |
| アラート | 重大エラー発生時にログへ記録（通知はインフラ確定後に検討） |

---

## 開発・デプロイ制約

| 項目 | 内容 |
|------|------|
| コンテナ基盤 | Docker / Docker Compose を使用した構成管理 |
| フロントエンド | Next.js + Tailwind CSS + shadcn/ui |
| バックエンド | Next.js API Routes（フルスタック構成） |
| データベース | PostgreSQL（Dockerコンテナで稼働） |
| Node.jsバージョン | LTS（Long Term Support）版を使用 |
| コード管理 | Gitによるソースコード管理 |
| デプロイ方式 | `docker compose up` による一括起動。稼働インフラはオンプレ・クラウドを問わずDockerが動作すれば可 |

## 法規制・コンプライアンス

| 区分 | 準拠内容 |
|------|---------|
| 個人情報保護法 | ユーザー情報（氏名・メールアドレス）を取り扱うため、取得目的の明示・適切な管理・廃棄手順を整備する |
| 情報セキュリティポリシー | 社内の情報セキュリティポリシーに準拠する（特にアクセス制限・パスワード管理） |
| ライセンス | 利用するOSSのライセンスを確認し、商用利用に問題のないものを選定する |
