---
name: mob-docs-technical-design
description: "Webアプリケーションの方式設計ドキュメント作成を支援するスキル。Small/Fullの設計書テンプレートに対応し、プロジェクト規模に応じた方式設計ドキュメントを体系的に作成する。要件定義の成果物を入力として、技術的な方針・選定根拠・トレードオフ分析を含むMaterial for MkDocs形式のドキュメントを出力する。トリガー: (1) 方式設計書の作成・編集を依頼された時、(2) 「方式設計」「技術設計」「technical design」に言及された時、(3) アーキテクチャ・インフラ・セキュリティ・データ・運用の方式を定義する時、(4) 技術スタック選定やアーキテクチャパターンの決定を行う時。"
---

# 方式設計ドキュメント作成スキル

## テンプレート判定

作業開始時にプロジェクトの CLAUDE.md を読み、「設計書テンプレート」の値（Small / Full）を確認する。
テンプレートの種別に応じてワークフロー・ファイル構成・成果物が変わるため、必ず最初に確認すること。

## ワークフロー概要

方式設計ドキュメントの作成は、設計書テンプレートに応じた以下のカテゴリで進める。
アーキテクチャ方式を最初に確定させ、その決定に基づいて他カテゴリを進めること。

### Fullテンプレート（5カテゴリ）

1. **アーキテクチャ方式** — アーキテクチャパターン、技術スタック、システムコンテキスト図の定義
2. **インフラ方式** — クラウド構成、ネットワーク設計、CI/CDパイプラインの定義
3. **セキュリティ方式** — 認証、認可、データ保護、WAF・DDoS対策の定義
4. **データ方式** — DB選定、キャッシュ戦略、ファイルストレージの定義
5. **運用方式** — 監視、ログ、災害復旧の方式定義

### Smallテンプレート（2カテゴリ）

1. **アーキテクチャ方式** — アーキテクチャパターン・技術スタック・システムコンテキストを1ファイルに統合
2. **インフラ・運用方式** — クラウド構成・ネットワーク・CI/CD・セキュリティ・データ方式・運用を1ファイルに統合

Smallではセキュリティ方式・データ方式・運用方式を独立カテゴリとせず、インフラ・運用方式に統合する。

## 前提条件

方式設計は要件定義（`docs/01-requirements/`）の成果物を入力とする。特に以下を参照する：

- **非機能要件**（性能・可用性・拡張性・セキュリティ）→ 方式選定の根拠
- **機能要件**（各機能モジュール）→ アーキテクチャ構成の判断材料
- **スコープ定義**（前提条件・制約条件）→ 技術選定の制約

**Smallテンプレートの場合の注意:**
要件定義がSmall構成（project-overview.md / functional-requirements.md / non-functional-requirements.md）の場合、各統合ファイルの該当セクションを参照する。

作業開始前に、対象カテゴリに関連する要件定義ドキュメントを必ず読み込むこと。

## 作業プロセス

### 0. index.md の確認（初回のみ）

`docs/02-technical-design/index.md` が未作成の場合、以下を含めて作成する：

- セクション概要
- 構成説明（各カテゴリの役割）
- **成果物一覧テーブル**（ステータス管理用）

成果物一覧テーブルはテンプレートに応じて以下を使い分ける：

**Fullテンプレート:**

```markdown
| 成果物 | 説明 | ステータス |
|--------|------|-----------|
| アーキテクチャ方式 | パターン・技術スタック・コンテキスト図 | 未着手 |
| インフラ方式 | クラウド・ネットワーク・CI/CD | 未着手 |
| セキュリティ方式 | 認証・認可・データ保護・WAF | 未着手 |
| データ方式 | DB・キャッシュ・ストレージ | 未着手 |
| 運用方式 | 監視・ログ・DR | 未着手 |
```

**Smallテンプレート:**

```markdown
| 成果物 | 説明 | ステータス |
|--------|------|-----------|
| アーキテクチャ方式 | パターン・技術スタック・コンテキスト図 | 未着手 |
| インフラ・運用方式 | クラウド・ネットワーク・CI/CD・セキュリティ・運用 | 未着手 |
```

### 1. 対象カテゴリの特定

ユーザーの依頼内容から作成対象を判断する：

- **タスク番号指定あり** → docs/index.md の「成果物一覧」から該当タスクに対応するファイル群を作成
- **カテゴリ名指定あり** → 該当カテゴリのファイル群を作成
- **指定なし** → カテゴリ1（アーキテクチャ方式）から順に提案

タスク番号とカテゴリの対応はテンプレートにより異なる：

**Fullテンプレート:**

| タスク | カテゴリ | 対象ファイル |
|--------|----------|-------------|
| #6 | アーキテクチャ方式 | architecture-pattern.md / technology-stack.md / system-context.md |
| #7 | インフラ方式 | cloud-architecture.md / network.md / ci-cd.md |
| #8 | セキュリティ方式 | authentication.md / authorization.md / data-protection.md / waf-ddos.md |
| #9 | データ方式 | database-selection.md / caching-strategy.md / file-storage.md |
| #10 | 運用方式 | monitoring.md / logging.md / disaster-recovery.md |

**Smallテンプレート:**

| タスク | カテゴリ | 対象ファイル |
|--------|----------|-------------|
| #4 | アーキテクチャ方式 | architecture.md |
| #5 | インフラ・運用方式 | infrastructure.md |

### 2. 関連要件の読み込み

対象カテゴリに応じて、以下の要件定義ドキュメントを読み込む：

**Fullテンプレート:**

| カテゴリ | 必須参照ドキュメント |
|----------|---------------------|
| アーキテクチャ方式 | scope.md, 機能要件全般, performance.md, scalability.md |
| インフラ方式 | availability.md, scalability.md, performance.md |
| セキュリティ方式 | security.md, compliance.md, ユースケース（認証関連） |
| データ方式 | 機能要件全般, performance.md, scalability.md |
| 運用方式 | availability.md, performance.md, compliance.md |

**Smallテンプレート:**

| カテゴリ | 必須参照ドキュメント |
|----------|---------------------|
| アーキテクチャ方式 | project-overview.md（スコープ）, functional-requirements.md, non-functional-requirements.md（性能・拡張性） |
| インフラ・運用方式 | non-functional-requirements.md（全般）, functional-requirements.md（外部連携） |

### 3. 既存テンプレートの確認

対象ファイルを読み込み、テンプレート構造（見出し・プレースホルダーコメント）を確認する。
テンプレートの `<!-- ... -->` コメントは記載すべき内容のガイドである。

### 4. ユーザーとの対話による方針決定

方式設計では技術選定の意思決定が中心となる。質問は一度に3〜5個に抑え、段階的に深掘りする。

**質問の優先順位:**

1. アーキテクチャ上の重要な意思決定（マイクロサービス vs モノリス 等）
2. 技術スタックの制約・希望（既存資産、チームスキル 等）
3. 非機能要件のトレードオフ判断（コスト vs 性能 等）

**方式設計特有の対話方針:**

- 選択肢を提示し、各選択肢のメリット・デメリットを簡潔に説明する
- 要件定義の非機能要件を根拠として選定理由を構成する
- ユーザーの技術的前提知識に合わせた説明レベルを調整する
- 未確定事項は仮決定として記録し、後続の設計フェーズで確定する旨を明記する

**Smallテンプレートの場合の注意:**
質問は主要な技術選定（アーキテクチャパターン・主要技術スタック・クラウドプロバイダ）に絞り、セキュリティやデータ方式の詳細な深掘りは行わない。

### 5. ドキュメント作成

テンプレートのプレースホルダーを実際の内容に置き換える。

**出力ルール:**

- Material for MkDocs互換のMarkdown形式で記述する
- 図表はMermaid記法を使用する（アーキテクチャ図、シーケンス図、ネットワーク図等）
- テーブルはMarkdownテーブルを使用する
- Admonition（`!!! note`、`!!! warning`、`!!! info` 等）を適宜活用する
- `<!-- ... -->` プレースホルダーコメントは残さず、すべて実際の内容に置き換える

**方式設計特有の記述スタイル:**

- **選定理由を必ず記載する** — 技術選定には「なぜその方式を選んだか」を明記する
- **比較表を活用する** — 候補となった技術の比較表を掲載し、選定プロセスを透明にする
- **トレードオフを明示する** — 選定した方式の利点と受容したリスクを記載する
- **要件との紐付け** — 非機能要件IDを参照し、要件根拠を明確にする
- 未確定事項には `!!! warning "要確認"` アドモニションを付与する

**比較表のフォーマット例:**

```markdown
| 観点 | 候補A | 候補B | 候補C |
|------|-------|-------|-------|
| 適合性 | ○ | △ | ○ |
| 運用コスト | △ | ○ | × |
| 学習コスト | ○ | ○ | △ |
| **総合評価** | **採用** | 次点 | 不採用 |
```

**Smallテンプレートの場合の記述方針:**

- 各統合ファイル内ではH2レベルで大分類、H3レベルで小分類に整理する
- 比較表は主要な選定（アーキテクチャパターン・技術スタック・クラウドプロバイダ）に絞る
- セキュリティ・データ・運用方式はインフラ・運用方式内でセクションとして簡潔に記述する
- 記述の粒度はFullより粗くてよいが、選定理由は必ず記載する

### 6. レビューと更新

作成したドキュメントの要約をユーザーに提示し、フィードバックを反映する。

## カテゴリ別リファレンス

各カテゴリの詳細な作成ガイドは以下のリファレンスを参照する。
テンプレートによって参照するガイドと使い方が異なる。

### Fullテンプレート

- **アーキテクチャ方式**（architecture-pattern.md / technology-stack.md / system-context.md）の作成時:
  → [references/architecture-guide.md](references/architecture-guide.md) を読む

- **インフラ方式**（cloud-architecture.md / network.md / ci-cd.md）の作成時:
  → [references/infrastructure-guide.md](references/infrastructure-guide.md) を読む

- **セキュリティ方式**（authentication.md / authorization.md / data-protection.md / waf-ddos.md）の作成時:
  → [references/security-guide.md](references/security-guide.md) を読む

- **データ方式**（database-selection.md / caching-strategy.md / file-storage.md）の作成時:
  → [references/data-guide.md](references/data-guide.md) を読む

- **運用方式**（monitoring.md / logging.md / disaster-recovery.md）の作成時:
  → [references/operations-guide.md](references/operations-guide.md) を読む

### Smallテンプレート

- **アーキテクチャ方式**（architecture.md）の作成時:
  → [references/architecture-guide.md](references/architecture-guide.md) を読む
  → ガイド内の「Smallテンプレートの場合」セクションに従い、1ファイルに統合する

- **インフラ・運用方式**（infrastructure.md）の作成時:
  → [references/infrastructure-guide.md](references/infrastructure-guide.md) を読む
  → ガイド内の「Smallテンプレートの場合」セクションに従い、インフラ・セキュリティ・データ・運用を1ファイルに統合する

## ファイル構成

方式設計ドキュメントは `docs/02-technical-design/` 配下に格納する。

### Fullテンプレート

```
docs/02-technical-design/
├── index.md                          # セクション概要・進捗管理
├── architecture/
│   ├── architecture-pattern.md       # アーキテクチャパターン
│   ├── technology-stack.md           # 技術スタック選定
│   └── system-context.md            # システムコンテキスト図
├── infrastructure/
│   ├── cloud-architecture.md         # クラウド構成
│   ├── network.md                    # ネットワーク設計
│   └── ci-cd.md                     # CI/CDパイプライン
├── security/
│   ├── authentication.md             # 認証方式
│   ├── authorization.md              # 認可方式
│   ├── data-protection.md            # データ保護
│   └── waf-ddos.md                  # WAF・DDoS対策
├── data/
│   ├── database-selection.md         # DB選定
│   ├── caching-strategy.md           # キャッシュ戦略
│   └── file-storage.md             # ファイルストレージ
└── operations/
    ├── monitoring.md                 # 監視方式
    ├── logging.md                    # ログ方式
    └── disaster-recovery.md         # DR方式
```

### Smallテンプレート

```
docs/02-technical-design/
├── index.md                          # セクション概要・進捗管理
├── architecture.md                   # アーキテクチャ・技術スタックを統合
└── infrastructure.md                 # インフラ・セキュリティ・運用を統合
```

## カテゴリ間の依存関係

### Fullテンプレート

```
アーキテクチャ方式 ──→ インフラ方式
       │           ──→ セキュリティ方式
       │           ──→ データ方式
       └─────────────→ 運用方式
```

- アーキテクチャ方式が全カテゴリの基盤（最初に確定）
- インフラ方式はアーキテクチャの物理配置を定義
- セキュリティ方式はアーキテクチャの横断的関心事を定義
- データ方式はアーキテクチャのデータ層を詳細化
- 運用方式はすべての方式の運用面を統合

### Smallテンプレート

```
アーキテクチャ方式 ──→ インフラ・運用方式
```

- アーキテクチャ方式で全体方針を確定し、インフラ・運用方式で具体化する

## ステータス管理

`index.md` の成果物一覧テーブルのステータスを以下のタイミングで更新する：

| ステータス | 更新タイミング |
|-----------|---------------|
| 未着手 | index.md 作成時の初期値 |
| 対応中 | カテゴリのドキュメント作成に着手した時 |
| 完了 | カテゴリのすべてのドキュメントが作成完了した時 |

**重要:** カテゴリの作成に着手する際は、ドキュメント編集の前に必ずステータスを「対応中」に更新すること。
