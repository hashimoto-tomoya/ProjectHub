---
name: mob-docs-review-agent-teams
description: "設計ドキュメントのレビューをステークホルダーの視点でエージェントチームにより実施するスキル。stakeholders.mdに定義されたステークホルダーから最大3名を自動選定し、ディスカッション形式でレビューを行い、議事録を.reviewsフォルダに保存する。トリガー: (1)「レビューして」「レビュー」と言及された時、(2) ドキュメントのフィードバックや品質チェックを依頼された時、(3)「ステークホルダーの視点で確認」と依頼された時。対象: docs/配下の要件定義書、方式設計書、基本設計書、詳細設計書。フェーズ単位またはファイル単位で指定可能。"
---

# ドキュメントレビュースキル

## 概要

ステークホルダーの視点を持つエージェントチーム（最大3名）でドキュメントをレビューし、議事録を出力する。

## テンプレート判定

CLAUDE.md を読み、`設計書テンプレート` の値を確認する:

- `設計書テンプレート: Small` → **Small ワークフロー**を適用
- `設計書テンプレート: Full` → **Full ワークフロー**を適用

テンプレートの違いにより、以下が変わる:

- ステークホルダー情報の読み込み元
- レビュー対象として指定可能なカテゴリ
- ファイルパスからのカテゴリ判定方法

## ワークフロー

### 1. レビュー対象の特定

ユーザーの指示からレビュー対象を判定する:

- **フェーズ指定**: 「要件定義をレビュー」「方式設計をレビュー」等 → 該当フェーズ配下の全ファイル
- **カテゴリ指定**: 「画面設計をレビュー」「セキュリティ方式をレビュー」等 → 該当カテゴリのファイル
- **ファイル指定**: 「architecture.mdをレビュー」等 → 指定ファイルのみ

**Smallテンプレートの場合:**

Smallでは各カテゴリが1ファイルに統合されているため、カテゴリ指定とファイル指定は実質同じになる。

指定可能なカテゴリ:

| フェーズ | カテゴリ | ファイル |
|---------|---------|---------|
| 要件定義 | プロジェクト概要 | project-overview.md |
| 要件定義 | 機能要件 | functional-requirements.md |
| 要件定義 | 非機能要件 | non-functional-requirements.md |
| 方式設計 | アーキテクチャ方式 | architecture.md |
| 方式設計 | インフラ・運用方式 | infrastructure.md |
| 基本設計 | 画面設計 | screen-design.md |
| 基本設計 | データモデル | data-model.md |
| 基本設計 | API設計 | api-design.md |
| 詳細設計 | コンポーネント設計 | component-design.md |
| 詳細設計 | テスト設計 | testing.md |

**Fullテンプレートの場合:**

カテゴリ指定はサブディレクトリ配下の全ファイルが対象になる。

### 2. レビュアー選定

[references/stakeholder-mapping.md](references/stakeholder-mapping.md) を読み、以下の手順でレビュアー3名を選定する:

**Fullテンプレートの場合:**

1. プロジェクトの `docs/01-requirements/project-overview/stakeholders.md` を読み込む
2. 各ステークホルダーを関心領域（BIZ/DOMAIN/BE/FE/INFRA等）に分類する
3. レビュー対象のドキュメントカテゴリに必要な関心領域を特定する
4. 優先度順にステークホルダーを最大3名選定する

**Smallテンプレートの場合:**

1. プロジェクトの `docs/01-requirements/project-overview.md` の「ステークホルダー」セクションを読み込む
2. 以降はFullと同じ手順で選定する

### 3. エージェントチーム構成

TeamCreateでチームを作成し、Taskツールで最大3名のレビュアーエージェントを起動する。

**重要な制約:**

- すべてのエージェントのAIモデルはSonnetを指定する。Opusは使用不可とする。（コスト削減）
- 各エージェントの `name` はステークホルダーの役割名をケバブケースにしたもの（例: `backend-team`, `infra-team`）

**各エージェントへのプロンプトに含める内容:**

1. 割り当てられたステークホルダーの役割と関心領域に基づくレビュー観点（stakeholder-mapping.mdの「関心領域別レビュー観点」から）
2. レビュー対象ファイルのパス一覧
3. レビューの指示:
   - 対象ファイルをすべて読み込む
   - 自分の役割の観点からレビューする
   - 指摘事項を「重大（Must Fix）」「改善推奨（Should Fix）」「提案（Nice to Have）」に分類する
   - 良い点も挙げる
   - レビュー結果をチームリーダーにSendMessageで送信する

### 4. ディスカッション進行

チームリーダー（自分）は以下の手順でディスカッションを進行する:

1. 全レビュアーからレビュー結果を受け取る
2. 重複する指摘や矛盾する指摘を特定する
3. 重要な指摘についてレビュアー間でディスカッションを促す（SendMessageで議題を提示）
4. 合意形成後、総合評価を決定する

**総合評価基準:**

| 評価 | 基準 |
|------|------|
| A: 承認 | 重大な指摘なし |
| B: 条件付き承認 | 軽微な修正が必要 |
| C: 要修正 | 重大な指摘あり、再レビュー必要 |

### 5. 議事録の作成

[references/review-template.md](references/review-template.md) のフォーマットに従い、議事録を作成する。

**出力先:** `.reviews/{phase}/{YYYY-MM-DD}_{subcategory}_review.md`

ディレクトリが存在しない場合は作成する。

**Smallテンプレートの場合:**

ファイル名が統合されているため、subcategoryはファイル名（拡張子なし）をそのまま使用する。

例: `.reviews/03-basic-design/2025-06-01_screen-design_review.md`

### 6. チームの解散

レビュー完了後、全エージェントにshutdown_requestを送信し、TeamDeleteでチームを削除する。

## エージェント名の命名ルール

ステークホルダー名からエージェント名を自動生成する:

1. 役割名の主要部分を英語に変換する
2. ケバブケース（小文字 + ハイフン区切り）にする
3. 括弧内の補足は省略する

**変換例:**
- 「バックエンドチーム」→ `backend-team`
- 「品質管理（QA）」→ `qa-team`
- 「プロジェクトオーナー」→ `project-owner`
- 「事業部門（EC事業部）」→ `business-division`
- 「エンドユーザー（顧客）」→ `end-user`

## 注意事項

- レビュー対象のドキュメントがテンプレート状態（プレースホルダーのみ）の場合、レビュー不要としてスキップする
- フェーズ指定でレビュー対象ファイルが多い場合は、サブカテゴリ単位で分割してレビューを実施する（Fullのみ。Smallではフェーズ内のファイル数が少ないため分割不要）
- 議事録は日本語で作成する
