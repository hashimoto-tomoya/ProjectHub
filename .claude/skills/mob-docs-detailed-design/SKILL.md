---
name: mob-docs-detailed-design
description: "Webアプリケーションの詳細設計ドキュメント作成を支援するスキル。Small/Fullの設計書テンプレートに対応し、プロジェクト規模に応じた詳細設計ドキュメントを体系的に作成する。要件定義・方式設計・基本設計の成果物を入力として、実装可能レベルの設計仕様をMaterial for MkDocs形式のドキュメントとして出力する。トリガー: (1) 詳細設計書の作成・編集を依頼された時、(2) 「詳細設計」「detailed design」に言及された時、(3) コンポーネント設計・シーケンス図・エラーハンドリング・テスト設計の作成を依頼された時、(4) FE/BEコンポーネント構成やテストケースの設計を行う時。"
---

# 詳細設計ドキュメント作成スキル

## テンプレート判定

作業開始時にプロジェクトの CLAUDE.md を読み、「設計書テンプレート」の値（Small / Full）を確認する。
テンプレートの種別に応じてワークフロー・ファイル構成・成果物が変わるため、必ず最初に確認すること。

## ワークフロー概要

詳細設計ドキュメントの作成は、設計書テンプレートに応じた以下のカテゴリで進める。

### Fullテンプレート（4カテゴリ）

1. **コンポーネント設計** — フロントエンド（コンポーネントツリー・状態管理・ルーティング）とバックエンド（ドメインモデル・サービス層・リポジトリ層）の実装構造を定義
2. **シーケンス図** — 主要な業務フローにおけるコンポーネント間の処理手順を時系列で図示
3. **エラーハンドリング** — エラーコード体系・エラーレスポンス形式・例外処理方針を定義
4. **テスト設計** — テスト戦略・テストケース（単体・結合・E2E）・テストデータを定義

コンポーネント設計を最初に確定させ、その構造に基づいて他カテゴリを進めること。

### Smallテンプレート（2カテゴリ）

1. **コンポーネント設計** — FE/BEコンポーネント構成を1ファイルに統合
2. **テスト設計** — テスト戦略・主要テストケースを1ファイルに統合

Smallではシーケンス図・エラーハンドリングは独立カテゴリとしない。
必要に応じて、主要フローのシーケンスはコンポーネント設計内で、エラー方針はテスト設計内で簡潔に触れる。

## 前提条件

詳細設計は要件定義（`docs/01-requirements/`）・方式設計（`docs/02-technical-design/`）・基本設計（`docs/03-basic-design/`）の成果物を入力とする。特に以下を参照する：

- **要件定義**
  - 機能要件（各機能モジュール）→ コンポーネント分割・テストケースの根拠
  - 非機能要件（性能・セキュリティ）→ 設計上の制約・テスト基準
  - ユースケース → シーケンス図の根拠（Fullのみ）
- **方式設計**
  - アーキテクチャ方式 → コンポーネント構成・レイヤ分割の方針
  - 技術スタック → 具体的なフレームワーク・ライブラリに基づく設計
  - セキュリティ方式 → 認証・認可フローのシーケンス、エラーハンドリング方針（Fullのみ）
  - データ方式 → リポジトリ層・キャッシュ戦略の設計根拠（Fullのみ）
- **基本設計**
  - システム構成 → コンポーネント間の通信フロー（Fullのみ）
  - 画面設計 → フロントエンドコンポーネントツリー・ルーティングの根拠
  - データモデル → ドメインモデル・リポジトリ層の設計根拠
  - API設計 → サービス層・シーケンス図・エラーレスポンスの根拠
  - バッチ設計 → バッチ処理のシーケンス・エラーハンドリングの根拠（Fullのみ）

**Smallテンプレートの場合の注意:**
前フェーズがSmall構成の場合、各統合ファイルの該当セクションを参照する。

作業開始前に、対象カテゴリに関連する前フェーズのドキュメントを必ず読み込むこと。

## 作業プロセス

### 0. index.md の確認（初回のみ）

`docs/04-detailed-design/index.md` が未作成の場合、以下を含めて作成する：

- セクション概要
- 構成説明（各カテゴリの役割）
- **成果物一覧テーブル**（ステータス管理用）

成果物一覧テーブルはテンプレートに応じて以下を使い分ける：

**Fullテンプレート:**

```markdown
| 成果物 | 説明 | ステータス |
|--------|------|-----------|
| コンポーネント設計 | FE/BEコンポーネント詳細 | 未着手 |
| シーケンス図 | 主要処理フロー | 未着手 |
| エラーハンドリング | エラーコード・例外処理 | 未着手 |
| テスト設計 | テスト戦略・ケース・データ | 未着手 |
```

**Smallテンプレート:**

```markdown
| 成果物 | 説明 | ステータス |
|--------|------|-----------|
| コンポーネント設計 | FE/BEコンポーネント構成 | 未着手 |
| テスト設計 | テスト戦略・主要テストケース | 未着手 |
```

### 1. 対象カテゴリの特定

ユーザーの依頼内容から作成対象を判断する：

- **タスク番号指定あり** → docs/index.md の「成果物一覧」から該当タスクに対応するファイル群を作成
- **カテゴリ名指定あり** → 該当カテゴリのファイル群を作成
- **指定なし** → カテゴリ1（コンポーネント設計）から順に提案

タスク番号とカテゴリの対応はテンプレートにより異なる：

**Fullテンプレート:**

| タスク | カテゴリ | 対象ファイル |
|--------|----------|-------------|
| #16 | コンポーネント設計 | FE: component-tree.md / state-management.md / routing.md、BE: domain-model.md / service-layer.md / repository-layer.md |
| #17 | シーケンス図 | プロジェクトの主要業務フロー（3〜5フロー程度） |
| #18 | エラーハンドリング | error-code-list.md / error-response-format.md / exception-handling.md |
| #19 | テスト設計 | test-strategy.md / test-data.md / unit-test.md / integration-test.md / e2e-test.md |

**Smallテンプレート:**

| タスク | カテゴリ | 対象ファイル |
|--------|----------|-------------|
| #9 | コンポーネント設計 | component-design.md |
| #10 | テスト設計 | testing.md |

※ 各タスクの具体的な対象ファイル数・ファイル名は docs/index.md の「成果物一覧」を参照すること。

### 2. 関連ドキュメントの読み込み

対象カテゴリに応じて、以下の前フェーズドキュメントを読み込む：

**Fullテンプレート:**

| カテゴリ | 必須参照ドキュメント |
|----------|---------------------|
| コンポーネント設計 | architecture-pattern.md, technology-stack.md, module-structure.md, screen-list.md, 画面定義, er-diagram.md, api-overview.md |
| シーケンス図 | ユースケース全般, system-overview.md, 画面定義, API仕様, バッチ定義, authentication.md, authorization.md |
| エラーハンドリング | api-overview.md（エラーレスポンス形式）, API仕様全般, バッチ定義全般, security.md |
| テスト設計 | 機能要件全般, 非機能要件全般, ユースケース全般, API仕様全般, 画面定義全般 |

**Smallテンプレート:**

| カテゴリ | 必須参照ドキュメント |
|----------|---------------------|
| コンポーネント設計 | architecture.md, screen-design.md, data-model.md, api-design.md |
| テスト設計 | functional-requirements.md, non-functional-requirements.md, screen-design.md, api-design.md |

### 3. 既存テンプレートの確認

対象ファイルを読み込み、テンプレート構造（見出し・プレースホルダーコメント）を確認する。
テンプレートの `<!-- ... -->` コメントは記載すべき内容のガイドである。

### 4. ユーザーとの対話による方針決定

詳細設計では実装レベルの具体的な構造・方針を決定する。質問は一度に3〜5個に抑え、段階的に深掘りする。

**質問の優先順位:**

1. 実装構造に関する判断（FEコンポーネント粒度、状態管理ライブラリ、レイヤ分割方針 等）
2. テスト方針に関する判断（カバレッジ目標、テストツール、テスト環境 等）
3. エラーハンドリングの方針（エラーコード体系、リトライ戦略、ユーザー通知方針 等）

**詳細設計特有の対話方針:**

- 基本設計で定義された構造をさらに具体化する方向で確認する
- コンポーネント設計では、責務分離の粒度と命名規則を確認する
- シーケンス図では、正常系だけでなく異常系・代替フローの範囲を確認する（Fullのみ）
- エラーハンドリングでは、ユーザー向けメッセージとシステム内部メッセージの区別方針を確認する（Fullのみ）
- テスト設計では、テストの優先順位（何を重点的にテストするか）を確認する
- 未確定事項は仮決定として記録し、実装フェーズで確定する旨を明記する

**Smallテンプレートの場合の注意:**
質問はFE/BEの主要コンポーネント構成とテスト方針に絞り、シーケンス図やエラーハンドリングの詳細な深掘りは行わない。

### 5. ドキュメント作成

テンプレートのプレースホルダーを実際の内容に置き換える。

**出力ルール:**

- Material for MkDocs互換のMarkdown形式で記述する
- 図表はMermaid記法を使用する（クラス図、シーケンス図、状態遷移図等）
- テーブルはMarkdownテーブルを使用する
- Admonition（`!!! note`、`!!! warning`、`!!! info` 等）を適宜活用する
- `<!-- ... -->` プレースホルダーコメントは残さず、すべて実際の内容に置き換える

**詳細設計特有の記述スタイル:**

- **実装可能な粒度で記述する** — 開発者がコードに落とし込める具体性を持たせる
- **責務を明確にする** — 各コンポーネント・クラス・関数の責務を一言で表現する
- **インターフェースを定義する** — 公開メソッド・プロパティ・イベントの仕様を明示する
- **トレーサビリティを確保する** — 基本設計の画面ID・API ID・テーブルIDとの紐付けを明記する
- **図を多用する** — Mermaidによるクラス図・シーケンス図・状態遷移図を積極活用する
- 未確定事項には `!!! warning "要確認"` アドモニションを付与する

**ID体系:**

詳細設計では以下のID体系を使用する（プロジェクトに応じて調整可）：

| カテゴリ | ID形式 | 例 |
|----------|--------|-----|
| FEコンポーネント | CMP-{種別}-XXX | CMP-PAGE-001, CMP-UI-001 |
| BEサービス | SVC-XXX | SVC-001 |
| BEリポジトリ | REP-XXX | REP-001 |
| ドメインモデル | DOM-XXX | DOM-001 |
| エラーコード | ERR-{カテゴリ}-XXX | ERR-AUTH-001, ERR-VAL-001 |
| テストケース | TC-{種別}-XXX | TC-UT-001, TC-IT-001, TC-E2E-001 |

**Smallテンプレートの場合の記述方針:**

- 各統合ファイル内ではH2レベルで大分類（FE/BE、テスト種別等）、H3レベルで小分類に整理する
- コンポーネント設計はFE/BEの主要コンポーネント構成を概要レベルで記述する
  - FE: 主要ページコンポーネントとルーティング、状態管理方針を簡潔に記述
  - BE: 主要サービス・リポジトリの責務一覧を記述
- テスト設計はテスト戦略＋主要テストケース（単体・結合・E2E各数件）で構成する
- ID体系はFullと同じものを使用する（一貫性のため）

### 6. レビューと更新

作成したドキュメントの要約をユーザーに提示し、フィードバックを反映する。

## カテゴリ別リファレンス

各カテゴリの詳細な作成ガイドは以下のリファレンスを参照する。
テンプレートによって参照するガイドと使い方が異なる。

### Fullテンプレート

- **コンポーネント設計**（FE: component-tree.md / state-management.md / routing.md、BE: domain-model.md / service-layer.md / repository-layer.md）の作成時:
  → [references/component-design-guide.md](references/component-design-guide.md) を読む

- **シーケンス図**（主要業務フローのシーケンス）の作成時:
  → [references/sequence-diagram-guide.md](references/sequence-diagram-guide.md) を読む

- **エラーハンドリング**（error-code-list.md / error-response-format.md / exception-handling.md）の作成時:
  → [references/error-handling-guide.md](references/error-handling-guide.md) を読む

- **テスト設計**（test-strategy.md / test-data.md / 各テストケース）の作成時:
  → [references/testing-guide.md](references/testing-guide.md) を読む

### Smallテンプレート

- **コンポーネント設計**（component-design.md）の作成時:
  → [references/component-design-guide.md](references/component-design-guide.md) を読む
  → ガイド内の「Smallテンプレートの場合」セクションに従い、FE/BEを1ファイルに統合する

- **テスト設計**（testing.md）の作成時:
  → [references/testing-guide.md](references/testing-guide.md) を読む
  → ガイド内の「Smallテンプレートの場合」セクションに従い、1ファイルに統合する

## ファイル構成

詳細設計ドキュメントは `docs/04-detailed-design/` 配下に格納する。

### Fullテンプレート

```
docs/04-detailed-design/
├── index.md                              # セクション概要・進捗管理
├── component-design/
│   ├── frontend/
│   │   ├── component-tree.md            # コンポーネントツリー
│   │   ├── state-management.md          # 状態管理設計
│   │   └── routing.md                   # ルーティング設計
│   └── backend/
│       ├── domain-model.md              # ドメインモデル
│       ├── service-layer.md             # サービス層設計
│       └── repository-layer.md          # リポジトリ層設計
├── sequence-diagrams/
│   └── {業務フロー名}.md                  # 主要業務フロー（3〜5件程度）
├── error-handling/
│   ├── error-code-list.md               # エラーコード一覧
│   ├── error-response-format.md         # エラーレスポンス形式
│   └── exception-handling.md            # 例外処理方針
└── testing/
    ├── test-strategy.md                  # テスト戦略
    ├── test-data.md                      # テストデータ定義
    └── test-cases/
        ├── unit-test.md                  # 単体テストケース
        ├── integration-test.md           # 結合テストケース
        └── e2e-test.md                   # E2Eテストケース
```

### Smallテンプレート

```
docs/04-detailed-design/
├── index.md                              # セクション概要・進捗管理
├── component-design.md                   # FE/BEコンポーネント構成を統合
└── testing.md                            # テスト戦略・主要テストケースを統合
```

## カテゴリ間の依存関係

### Fullテンプレート

```
コンポーネント設計 ──→ シーケンス図
        │          ──→ エラーハンドリング
        │          ──→ テスト設計
        │
シーケンス図 ──→ エラーハンドリング（異常系フローの根拠）
エラーハンドリング ──→ テスト設計（エラーケースのテスト根拠）
```

- コンポーネント設計が全カテゴリの基盤（最初に確定）
- シーケンス図はコンポーネント間の相互作用を明確にし、エラーハンドリングの根拠となる
- エラーハンドリングはAPI・バッチの異常系を定義し、テスト設計の入力となる
- テスト設計はすべてのカテゴリの成果物を検証対象とする

### Smallテンプレート

```
コンポーネント設計 ──→ テスト設計
```

- コンポーネント設計でFE/BE構成を確定し、テスト設計でその検証方針を定義する

## ステータス管理

`index.md` の成果物一覧テーブルのステータスを以下のタイミングで更新する：

| ステータス | 更新タイミング |
|-----------|---------------|
| 未着手 | index.md 作成時の初期値 |
| 対応中 | カテゴリのドキュメント作成に着手した時 |
| 完了 | カテゴリのすべてのドキュメントが作成完了した時 |

**重要:** カテゴリの作成に着手する際は、ドキュメント編集の前に必ずステータスを「対応中」に更新すること。
